import requests
from requests.auth import HTTPBasicAuth

# Confluence details
CONFLUENCE_BASE_URL = "https://your-org.atlassian.net/wiki"
API_URL = f"{CONFLUENCE_BASE_URL}/rest/api/content/search"
USERNAME = "your-email@example.com"   # Atlassian account email
API_TOKEN = "your-pat-token"          # Personal Access Token

def search_confluence(keyword: str):
    params = {
        "cql": f'text~"{keyword}"',
        "limit": 10,
    }
    response = requests.get(
        API_URL,
        params=params,
        auth=HTTPBasicAuth(USERNAME, PASSWORD),   # <-- try with password first
        headers={"Accept": "application/json"},
        verify=False   # ⚠️ only for testing, replace with your root cert
    )

    if response.status_code != 200:
        raise Exception(f"Error: {response.status_code}, {response.text}")

    data = response.json()
    results = []
    for r in data.get("results", []):
        title = r.get("title")
        url = f"{BASE_URL}{r['_links']['webui']}"
        results.append({"title": title, "url": url})
    return results

if __name__ == "__main__":
    for r in search_confluence("deployment"):
        print(f"{r['title']} → {r['url']}")