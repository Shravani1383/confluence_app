import requests
from requests.auth import HTTPBasicAuth

# Confluence details
CONFLUENCE_BASE_URL = "https://your-org.atlassian.net/wiki"
API_URL = f"{CONFLUENCE_BASE_URL}/rest/api/content/search"
USERNAME = "your-email@example.com"   # Atlassian account email
API_TOKEN = "your-pat-token"          # Personal Access Token

def search_confluence(keyword: str):
    params = {
        "cql": f'text~"{keyword}"',
        "limit": 10,
    }
    headers = {
        "Authorization": f"Bearer {API_TOKEN}",   # <-- try this
        "Accept": "application/json"
    }

    response = requests.get(API_URL, params=params, headers=headers, verify=False)

    if response.status_code != 200:
        raise Exception(f"Error: {response.status_code}, {response.text}")

    data = response.json()
    return [
        {
            "title": r.get("title"),
            "url": f"{CONFLUENCE_BASE_URL}{r['_links']['webui']}"
        }
        for r in data.get("results", [])
    ]

if __name__ == "__main__":
    results = search_confluence("deployment")
    for r in results:
        print(f"{r['title']} â†’ {r['url']}")
